<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Palestine Profile Maker - FalasTech</title>

  <meta name="title" content="FalasTech - Palestine Profile Pic Generator ğŸ‡µğŸ‡¸">
  <meta name="description"
    content="Show your support for Palestine with custom profile frames and overlays. Add your country flag to proudly represent where you're supporting from.">
  <meta name="keywords"
    content="FalasTech, Palestine, profile picture maker, palestine profile generator, country flags, solidarity, Free Palestine, digital activism, tech for justice, open-source">
  <meta name="robots" content="index, follow">
  <meta name="author" content="FalasTech">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ppm.falastech.org/">
  <meta property="og:title" content="Palestine Profile Pic Generator by FalasTech">
  <meta property="og:description"
    content="Create a custom profile picture with a Palestine frame and your country's flag â€” to show where you're supporting from. Stand in digital solidarity today.">
  <meta property="og:image" content="https://ppm.falastech.org/assets/preview-profile-maker.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://ppm.falastech.org/">
  <meta name="twitter:title" content="Palestine Profile Pic Generator by FalasTech">
  <meta name="twitter:description"
    content="Support Palestine digitally. Add a powerful Palestine frame and your countryâ€™s flag to your profile picture.">
  <meta name="twitter:image" content="https://ppm.falastech.org/assets/preview-profile-maker.jpg">

  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    canvas {
      cursor: move;
      transition: opacity 0.3s ease-in-out;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
    }

    .icon-transition {
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .frame-thumbnail {
      border: 3px solid transparent;
      transition: border-color 0.2s;
    }

    .frame-thumbnail.selected {
      border-color: #EF4444;
    }

    .resolution-button.selected {
      background-color: #EF4444;
      border-color: #EF4444;
      color: white;
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100 min-h-screen font-sans">

  <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-50">
    <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold flex items-center">
        <span class="mr-2 text-red-500">ğŸ‡µğŸ‡¸</span>
        Palestine Profile Maker
      </h1>
      <button id="themeButton"
        class="text-sm p-2 rounded-full bg-gray-200 dark:bg-gray-700 dark:text-white flex items-center justify-center">
        <i id="themeIcon" data-lucide="sun" aria-label="Toggle Dark Mode" class="w-5 h-5 icon-transition"></i>
      </button>
    </div>
  </header>

  <main class="max-w-4xl mx-auto p-6">
    <div class="flex flex-col md:flex-row gap-6">

      <div class="flex-1">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg flex flex-col items-center">
          <div class="mb-6 w-full flex justify-center">
            <canvas id="canvas" width="300" height="300"
              class="rounded-full border-4 border-gray-200 dark:border-gray-700 shadow-xl w-64 h-64 md:w-80 md:h-80"></canvas>
          </div>
          <div class="w-full text-center space-y-4">
            <button id="previewButton"
              class="w-full px-5 py-3 rounded-full bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition-colors hidden">
              Preview Profile Picture
            </button>
            <div id="editControls" class="flex justify-around items-center space-x-2 hidden">
              <button id="zoomOutBtn" title="Zoom Out"
                class="p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <i data-lucide="zoom-out" class="w-6 h-6 text-gray-700 dark:text-gray-200"></i>
              </button>
              <button id="zoomInBtn" title="Zoom In"
                class="p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <i data-lucide="zoom-in" class="w-6 h-6 text-gray-700 dark:text-gray-200"></i>
              </button>
              <button id="rotateBtn" title="Rotate"
                class="p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <i data-lucide="rotate-ccw" class="w-6 h-6 text-gray-700 dark:text-gray-200"></i>
              </button>
              <button id="resetBtn" title="Reset"
                class="p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <i data-lucide="refresh-ccw" class="w-6 h-6 text-gray-700 dark:text-gray-200"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1 space-y-6">

        <div id="step1" class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg">
          <h2 class="text-xl font-bold mb-4">Step 1: Get Your Photo</h2>
          <div class="grid grid-cols-2 gap-4">
            <label for="upload"
              class="flex flex-col items-center justify-center p-6 rounded-2xl border-2 border-dashed border-gray-300 dark:border-gray-600 cursor-pointer hover:border-red-500 transition">
              <i data-lucide="image" class="w-8 h-8 text-gray-500 dark:text-gray-400 mb-2"></i>
              <span class="text-sm font-semibold text-gray-700 dark:text-gray-200">Upload Image</span>
            </label>
            <input type="file" id="upload" accept="image/*" class="hidden" />

            <button onClick="fetchAvatar('x')"
              class="flex flex-col items-center justify-center p-6 rounded-2xl bg-black text-white hover:bg-gray-800 transition">
              <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/x.svg" alt="X (Twitter) Logo" class="h-8 w-8 filter invert mb-2">
              <span class="text-sm font-semibold">X (Twitter)</span>
            </button>
            <button onClick="fetchAvatar('github')"
              class="flex flex-col items-center justify-center p-6 rounded-2xl bg-gray-800 text-white hover:bg-gray-700 transition">
              <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg" alt="GitHub Logo" class="h-8 w-8 filter invert mb-2">
              <span class="text-sm font-semibold">GitHub</span>
            </button>
            <button onClick="fetchAvatar('gitlab')"
              class="flex flex-col items-center justify-center p-6 rounded-2xl bg-red-600 text-white hover:bg-red-700 transition">
              <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/gitlab.svg" alt="GitLab Logo" class="h-8 w-8 filter invert mb-2">
              <span class="text-sm font-semibold">GitLab</span>
            </button>
          </div>
        </div>

        <div id="step2" class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg hidden">
          <h2 class="text-xl font-bold mb-4">Step 2: Choose Your Frame</h2>
          <div class="flex justify-around items-center space-x-2 mb-4">
            <button onclick="changeFrame('default')" id="frameBtn_default"
              class="relative w-24 h-24 md:w-28 md:h-28 rounded-2xl overflow-hidden frame-thumbnail selected">
              <img src="frames/bg.webp" alt="Default Frame" class="w-full h-full object-cover">
            </button>
            <button onclick="changeFrame('flag')" id="frameBtn_flag"
              class="relative w-24 h-24 md:w-28 md:h-28 rounded-2xl overflow-hidden frame-thumbnail">
              <img src="frames/bg-country.webp" alt="With Country Flag" class="w-full h-full object-cover">
            </button>
            <button onclick="changeFrame('freepalestine')" id="frameBtn_freepalestine"
              class="relative w-24 h-24 md:w-28 md:h-28 rounded-2xl overflow-hidden frame-thumbnail">
              <img src="frames/bg-freepalestine.webp" alt="#FreePalestine Overlay" class="w-full h-full object-cover">
            </button>
          </div>

          <div id="countrySelectorContainer" class="hidden mt-4">
            <label class="block text-sm font-medium mb-1">Select Country</label>
            <select id="countrySelect"
              class="w-full px-4 py-2 border rounded-xl bg-gray-100 dark:bg-gray-700 dark:border-gray-600">
              <option value="">Choose a Country</option>
              <option value="afghanistan">ğŸ‡¦ğŸ‡« Afghanistan</option>
              <option value="albania">ğŸ‡¦ğŸ‡± Albania</option>
              <option value="algeria">ğŸ‡©ğŸ‡¿ Algeria</option>
              <option value="andorra">ğŸ‡¦ğŸ‡© Andorra</option>
              <option value="angola">ğŸ‡¦ğŸ‡´ Angola</option>
              <option value="argentina">ğŸ‡¦ğŸ‡· Argentina</option>
              <option value="armenia">ğŸ‡¦ğŸ‡² Armenia</option>
              <option value="australia">ğŸ‡¦ğŸ‡º Australia</option>
              <option value="austria">ğŸ‡¦ğŸ‡¹ Austria</option>
              <option value="azerbaijan">ğŸ‡¦ğŸ‡¿ Azerbaijan</option>
              <option value="bahamas">ğŸ‡§ğŸ‡¸ Bahamas</option>
              <option value="bahrain">ğŸ‡§ğŸ‡­ Bahrain</option>
              <option value="bangladesh">ğŸ‡§ğŸ‡© Bangladesh</option>
              <option value="barbados">ğŸ‡§ğŸ‡§ Barbados</option>
              <option value="belarus">ğŸ‡§ğŸ‡¾ Belarus</option>
              <option value="belgium">ğŸ‡§ğŸ‡ª Belgium</option>
              <option value="belize">ğŸ‡§ğŸ‡¿ Belize</option>
              <option value="benin">ğŸ‡§ğŸ‡¯ Benin</option>
              <option value="bhutan">ğŸ‡§ğŸ‡¹ Bhutan</option>
              <option value="bolivia">ğŸ‡§ğŸ‡´ Bolivia</option>
              <option value="bosnia-and-herzegovina">ğŸ‡§ğŸ‡¦ Bosnia and Herzegovina</option>
              <option value="botswana">ğŸ‡§ğŸ‡¼ Botswana</option>
              <option value="brazil">ğŸ‡§ğŸ‡· Brazil</option>
              <option value="brunei">ğŸ‡§ğŸ‡³ Brunei</option>
              <option value="bulgaria">ğŸ‡§ğŸ‡¬ Bulgaria</option>
              <option value="burkina-faso">ğŸ‡§ğŸ‡« Burkina Faso</option>
              <option value="burundi">ğŸ‡§ğŸ‡® Burundi</option>
              <option value="cambodia">ğŸ‡°ğŸ‡­ Cambodia</option>
              <option value="cameroon">ğŸ‡¨ğŸ‡² Cameroon</option>
              <option value="canada">ğŸ‡¨ğŸ‡¦ Canada</option>
              <option value="cape-verde">ğŸ‡¨ğŸ‡» Cape Verde</option>
              <option value="central-african-republic">ğŸ‡¨ğŸ‡« Central African Republic</option>
              <option value="chad">ğŸ‡¹ğŸ‡© Chad</option>
              <option value="chile">ğŸ‡¨ğŸ‡± Chile</option>
              <option value="china">ğŸ‡¨ğŸ‡³ China</option>
              <option value="colombia">ğŸ‡¨ğŸ‡´ Colombia</option>
              <option value="comoros">ğŸ‡°ğŸ‡² Comoros</option>
              <option value="congo">ğŸ‡¨ğŸ‡¬ Congo</option>
              <option value="costa-rica">ğŸ‡¨ğŸ‡· Costa Rica</option>
              <option value="croatia">ğŸ‡­ğŸ‡· Croatia</option>
              <option value="cuba">ğŸ‡¨ğŸ‡º Cuba</option>
              <option value="cyprus">ğŸ‡¨ğŸ‡¾ Cyprus</option>
              <option value="czech-republic">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
              <option value="denmark">ğŸ‡©ğŸ‡° Denmark</option>
              <option value="djibouti">ğŸ‡©ğŸ‡¯ Djibouti</option>
              <option value="dominica">ğŸ‡©ğŸ‡² Dominica</option>
              <option value="dominican-republic">ğŸ‡©ğŸ‡´ Dominican Republic</option>
              <option value="ecuador">ğŸ‡ªğŸ‡¨ Ecuador</option>
              <option value="egypt">ğŸ‡ªğŸ‡¬ Egypt</option>
              <option value="el-salvador">ğŸ‡¸ğŸ‡» El Salvador</option>
              <option value="equatorial-guinea">ğŸ‡¬ğŸ‡¶ Equatorial Guinea</option>
              <option value="eritrea">ğŸ‡ªğŸ‡· Eritrea</option>
              <option value="estonia">ğŸ‡ªğŸ‡ª Estonia</option>
              <option value="eswatini">ğŸ‡¸ğŸ‡¿ Eswatini</option>
              <option value="ethiopia">ğŸ‡ªğŸ‡¹ Ethiopia</option>
              <option value="fiji">ğŸ‡«ğŸ‡¯ Fiji</option>
              <option value="finland">ğŸ‡«ğŸ‡® Finland</option>
              <option value="france">ğŸ‡«ğŸ‡· France</option>
              <option value="gabon">ğŸ‡¬ğŸ‡¦ Gabon</option>
              <option value="gambia">ğŸ‡¬ğŸ‡² Gambia</option>
              <option value="georgia">ğŸ‡¬ğŸ‡ª Georgia</option>
              <option value="germany">ğŸ‡©ğŸ‡ª Germany</option>
              <option value="ghana">ğŸ‡¬ğŸ‡­ Ghana</option>
              <option value="greece">ğŸ‡¬ğŸ‡· Greece</option>
              <option value="grenada">ğŸ‡¬ğŸ‡© Grenada</option>
              <option value="guatemala">ğŸ‡¬ğŸ‡¹ Guatemala</option>
              <option value="guinea">ğŸ‡¬ğŸ‡³ Guinea</option>
              <option value="guinea-bissau">ğŸ‡¬ğŸ‡¼ Guinea-Bissau</option>
              <option value="guyana">ğŸ‡¬ğŸ‡¾ Guyana</option>
              <option value="haiti">ğŸ‡­ğŸ‡¹ Haiti</option>
              <option value="honduras">ğŸ‡­ğŸ‡³ Honduras</option>
              <option value="hungary">ğŸ‡­ğŸ‡º Hungary</option>
              <option value="iceland">ğŸ‡®ğŸ‡¸ Iceland</option>
              <option value="india">ğŸ‡®ğŸ‡³ India</option>
              <option value="indonesia">ğŸ‡®ğŸ‡© Indonesia</option>
              <option value="iran">ğŸ‡®ğŸ‡· Iran</option>
              <option value="iraq">ğŸ‡®ğŸ‡¶ Iraq</option>
              <option value="ireland">ğŸ‡®ğŸ‡ª Ireland</option>
              <option value="israel">ğŸ‡®ğŸ‡± Israel</option>
              <option value="italy">ğŸ‡®ğŸ‡¹ Italy</option>
              <option value="jamaica">ğŸ‡¯ğŸ‡² Jamaica</option>
              <option value="japan">ğŸ‡¯ğŸ‡µ Japan</option>
              <option value="jordan">ğŸ‡¯ğŸ‡´ Jordan</option>
              <option value="kazakhstan">ğŸ‡°ğŸ‡¿ Kazakhstan</option>
              <option value="kenya">ğŸ‡°ğŸ‡ª Kenya</option>
              <option value="kiribati">ğŸ‡°ğŸ‡® Kiribati</option>
              <option value="kosovo">ğŸ‡½ğŸ‡° Kosovo</option>
              <option value="kuwait">ğŸ‡°ğŸ‡¼ Kuwait</option>
              <option value="kyrgyzstan">ğŸ‡°ğŸ‡¬ Kyrgyzstan</option>
              <option value="laos">ğŸ‡±ğŸ‡¦ Laos</option>
              <option value="latvia">ğŸ‡±ğŸ‡» Latvia</option>
              <option value="lebanon">ğŸ‡±ğŸ‡§ Lebanon</option>
              <option value="lesotho">ğŸ‡±ğŸ‡¸ Lesotho</option>
              <option value="liberia">ğŸ‡±ğŸ‡· Liberia</option>
              <option value="libya">ğŸ‡±ğŸ‡¾ Libya</option>
              <option value="liechtenstein">ğŸ‡±ğŸ‡® Liechtenstein</option>
              <option value="lithuania">ğŸ‡±ğŸ‡¹ Lithuania</option>
              <option value="luxembourg">ğŸ‡±ğŸ‡º Luxembourg</option>
              <option value="madagascar">ğŸ‡²ğŸ‡¬ Madagascar</option>
              <option value="malawi">ğŸ‡²ğŸ‡¼ Malawi</option>
              <option value="malaysia">ğŸ‡²ğŸ‡¾ Malaysia</option>
              <option value="maldives">ğŸ‡²ğŸ‡» Maldives</option>
              <option value="mali">ğŸ‡²ğŸ‡± Mali</option>
              <option value="malta">ğŸ‡²ğŸ‡¹ Malta</option>
              <option value="marshall-islands">ğŸ‡²ğŸ‡­ Marshall Islands</option>
              <option value="mauritania">ğŸ‡²ğŸ‡· Mauritania</option>
              <option value="mauritius">ğŸ‡²ğŸ‡º Mauritius</option>
              <option value="mexico">ğŸ‡²ğŸ‡½ Mexico</option>
              <option value="micronesia">ğŸ‡«ğŸ‡² Micronesia</option>
              <option value="moldova">ğŸ‡²ğŸ‡© Moldova</option>
              <option value="monaco">ğŸ‡²ğŸ‡¨ Monaco</option>
              <option value="mongolia">ğŸ‡²ğŸ‡³ Mongolia</option>
              <option value="montenegro">ğŸ‡²ğŸ‡ª Montenegro</option>
              <option value="morocco">ğŸ‡²ğŸ‡¦ Morocco</option>
              <option value="mozambique">ğŸ‡²ğŸ‡¿ Mozambique</option>
              <option value="myanmar">ğŸ‡²ğŸ‡² Myanmar</option>
              <option value="namibia">ğŸ‡³ğŸ‡¦ Namibia</option>
              <option value="nauru">ğŸ‡³ğŸ‡· Nauru</option>
              <option value="nepal">ğŸ‡³ğŸ‡µ Nepal</option>
              <option value="netherlands">ğŸ‡³ğŸ‡± Netherlands</option>
              <option value="new-zealand">ğŸ‡³ğŸ‡¿ New Zealand</option>
              <option value="nicaragua">ğŸ‡³ğŸ‡® Nicaragua</option>
              <option value="niger">ğŸ‡³ğŸ‡ª Niger</option>
              <option value="nigeria">ğŸ‡³ğŸ‡¬ Nigeria</option>
              <option value="north-korea">ğŸ‡°ğŸ‡µ North Korea</option>
              <option value="north-macedonia">ğŸ‡²ğŸ‡° North Macedonia</option>
              <option value="norway">ğŸ‡³ğŸ‡´ Norway</option>
              <option value="oman">ğŸ‡´ğŸ‡² Oman</option>
              <option value="pakistan">ğŸ‡µğŸ‡° Pakistan</option>
              <option value="palau">ğŸ‡µğŸ‡¼ Palau</option>
              <option value="palestine">ğŸ‡µğŸ‡¸ Palestine</option>
              <option value="panama">ğŸ‡µğŸ‡¦ Panama</option>
              <option value="papua-new-guinea">ğŸ‡µğŸ‡¬ Papua New Guinea</option>
              <option value="paraguay">ğŸ‡µğŸ‡¾ Paraguay</option>
              <option value="peru">ğŸ‡µğŸ‡ª Peru</option>
              <option value="philippines">ğŸ‡µğŸ‡­ Philippines</option>
              <option value="poland">ğŸ‡µğŸ‡± Poland</option>
              <option value="portugal">ğŸ‡µğŸ‡¹ Portugal</option>
              <option value="qatar">ğŸ‡¶ğŸ‡¦ Qatar</option>
              <option value="romania">ğŸ‡·ğŸ‡´ Romania</option>
              <option value="russia">ğŸ‡·ğŸ‡º Russia</option>
              <option value="rwanda">ğŸ‡·ğŸ‡¼ Rwanda</option>
              <option value="saint-kitts-and-nevis">ğŸ‡°ğŸ‡³ Saint Kitts and Nevis</option>
              <option value="saint-lucia">ğŸ‡±ğŸ‡¨ Saint Lucia</option>
              <option value="saint-vincent-and-the-grenadines">ğŸ‡»ğŸ‡¨ Saint Vincent and the Grenadines</option>
              <option value="samoa">ğŸ‡¼ğŸ‡¸ Samoa</option>
              <option value="san-marino">ğŸ‡¸ğŸ‡² San Marino</option>
              <option value="sao-tome-and-principe">ğŸ‡¸ğŸ‡¹ SÃ£o TomÃ© and PrÃ­ncipe</option>
              <option value="saudi-arabia">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
              <option value="senegal">ğŸ‡¸ğŸ‡³ Senegal</option>
              <option value="serbia">ğŸ‡·ğŸ‡¸ Serbia</option>
              <option value="seychelles">ğŸ‡¸ğŸ‡¨ Seychelles</option>
              <option value="sierra-leone">ğŸ‡¸ğŸ‡± Sierra Leone</option>
              <option value="singapore">ğŸ‡¸ğŸ‡¬ Singapore</option>
              <option value="slovakia">ğŸ‡¸ğŸ‡° Slovakia</option>
              <option value="slovenia">ğŸ‡¸ğŸ‡® Slovenia</option>
              <option value="solomon-islands">ğŸ‡¸ğŸ‡§ Solomon Islands</option>
              <option value="somalia">ğŸ‡¸ğŸ‡´ Somalia</option>
              <option value="south-africa">ğŸ‡¿ğŸ‡¦ South Africa</option>
              <option value="south-korea">ğŸ‡°ğŸ‡· South Korea</option>
              <option value="south-sudan">ğŸ‡¸ğŸ‡¸ South Sudan</option>
              <option value="spain">ğŸ‡ªğŸ‡¸ Spain</option>
              <option value="sri-lanka">ğŸ‡±ğŸ‡° Sri Lanka</option>
              <option value="sudan">ğŸ‡¸ğŸ‡© Sudan</option>
              <option value="suriname">ğŸ‡¸ğŸ‡· Suriname</option>
              <option value="sweden">ğŸ‡¸ğŸ‡ª Sweden</option>
              <option value="switzerland">ğŸ‡¨ğŸ‡­ Switzerland</option>
              <option value="syria">ğŸ‡¸ğŸ‡¾ Syria</option>
              <option value="taiwan">ğŸ‡¹ğŸ‡¼ Taiwan</option>
              <option value="tajikistan">ğŸ‡¹ğŸ‡¯ Tajikistan</option>
              <option value="tanzania">ğŸ‡¹ğŸ‡¿ Tanzania</option>
              <option value="thailand">ğŸ‡¹ğŸ‡­ Thailand</option>
              <option value="togo">ğŸ‡¹ğŸ‡¬ Togo</option>
              <option value="tonga">ğŸ‡¹ğŸ‡´ Tonga</option>
              <option value="trinidad-and-tobago">ğŸ‡¹ğŸ‡¹ Trinidad and Tobago</option>
              <option value="tunisia">ğŸ‡¹ğŸ‡³ Tunisia</option>
              <option value="turkey">ğŸ‡¹ğŸ‡· Turkey</option>
              <option value="turkmenistan">ğŸ‡¹ğŸ‡² Turkmenistan</option>
              <option value="tuvalu">ğŸ‡¹ğŸ‡» Tuvalu</option>
              <option value="uganda">ğŸ‡ºğŸ‡¬ Uganda</option>
              <option value="ukraine">ğŸ‡ºğŸ‡¦ Ukraine</option>
              <option value="united-arab-emirates">ğŸ‡¦ğŸ‡ª United Arab Emirates</option>
              <option value="united-kingdom">ğŸ‡¬ğŸ‡§ United Kingdom</option>
              <option value="united-states">ğŸ‡ºğŸ‡¸ United States</option>
              <option value="uruguay">ğŸ‡ºğŸ‡¾ Uruguay</option>
              <option value="uzbekistan">ğŸ‡ºğŸ‡¿ Uzbekistan</option>
              <option value="vanuatu">ğŸ‡»ğŸ‡º Vanuatu</option>
              <option value="vatican-city">ğŸ‡»ğŸ‡¦ Vatican City</option>
              <option value="venezuela">ğŸ‡»ğŸ‡ª Venezuela</option>
              <option value="vietnam">ğŸ‡»ğŸ‡³ Vietnam</option>
              <option value="yemen">ğŸ‡¾ğŸ‡ª Yemen</option>
              <option value="zambia">ğŸ‡¿ğŸ‡² Zambia</option>
              "zimbabwe": "zw"
            </select>
          </div>
        </div>

        <div id="step3" class="bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg hidden">
          <h2 class="text-xl font-bold mb-4">Step 3: Download & Share</h2>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Choose your preferred image quality and download your
            new profile picture.</p>
          <div class="flex justify-between items-center gap-2 mb-4">
            <span class="text-sm font-medium">Select Size:</span>
            <div class="flex space-x-2">
              <button onclick="selectResolution(300)" id="resBtn_300"
                class="resolution-button px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 font-semibold selected">300x300</button>
              <button onclick="selectResolution(512)" id="resBtn_512"
                class="resolution-button px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 font-semibold">512x512</button>
              <button onclick="selectResolution(1080)" id="resBtn_1080"
                class="resolution-button px-4 py-2 rounded-full border border-gray-300 dark:border-gray-600 font-semibold">1080x1080</button>
            </div>
          </div>
          <button id="downloadBtn"
            class="w-full px-5 py-3 rounded-full bg-green-600 text-white hover:bg-green-700 transition shadow-lg font-semibold">
            Download Final Image
          </button>
        </div>

      </div>

    </div>

    <div id="browserWarning"
      class="hidden mt-6 bg-red-100 text-red-700 p-4 rounded-xl font-medium text-sm text-center dark:bg-red-800 dark:text-white">
      âš ï¸ Unsupported Browser Detected. Please open this page in your default browser for the best experience.
    </div>

    <p class="text-xs mt-6 text-gray-400 dark:text-gray-500 text-center">
      This tool is open-source and works entirely in your browser. We donâ€™t store or share your data.
    </p>

  </main>

  <script src="country_codes.js"></script>

  <script>
    let userImg = new Image();
    userImg.crossOrigin = "anonymous";
    let frame = new Image();
    let currentFrame = "default";
    let framePaths = {
      default: "frames/bg.webp",
      flag: "frames/bg-country.webp",
      freepalestine: "frames/bg-freepalestine.webp"
    };
    let flagImg = new Image();
    flagImg.crossOrigin = "anonymous";
    let selectedFlag = null;
    let selectedCountry = null;
    let selectedResolution = 300;
    let imgX = 150,
      imgY = 150,
      isDragging = false,
      startX, startY;
    let scale = 1,
      rotation = 0;
    const html = document.documentElement;

    function toggleDarkMode() {
      html.classList.toggle("dark");
      const icon = document.getElementById("themeIcon");
      icon.setAttribute("data-lucide", html.classList.contains("dark") ? "moon" : "sun");
      lucide.createIcons();
    }

    function setFrame(type) {
      currentFrame = type;
      frame.crossOrigin = "anonymous";
      frame.src = framePaths[type];
      frame.onload = () => {
        drawMainCanvas();
      };
    }

    function drawCanvas(context, image, canvasSize = 300) {
      context.clearRect(0, 0, canvasSize, canvasSize);
      // Always draw the frame
      if (frame && frame.complete) {
        context.drawImage(frame, 0, 0, canvasSize, canvasSize);
      }
      // Draw user image only if it's valid
      if (image && image.complete && image.naturalWidth > 0) {
        context.save();
        context.beginPath();
        context.arc(canvasSize / 2, canvasSize / 2, (canvasSize / 2) * 0.9, 0, Math.PI * 2);
        context.closePath();
        context.clip();
        context.translate(canvasSize / 2, canvasSize / 2);
        context.rotate(rotation);

        // --- ASPECT RATIO FIX START ---
        const targetDim = 300;
        // Calculate the initial scale factor to make the image 'cover' the 300x300 preview area
        const initialScale = Math.max(targetDim / image.naturalWidth, targetDim / image.naturalHeight);

        // Combine with the user's zoom factor ('scale') and the canvas resolution factor
        const totalScaleFactor = initialScale * scale * (canvasSize / 300);

        // Calculate drawing dimensions while preserving aspect ratio
        const dWidth = image.naturalWidth * totalScaleFactor;
        const dHeight = image.naturalHeight * totalScaleFactor;

        // Calculate drawing position relative to the translated context center (0,0)
        // The imgX/imgY (150-based) represents the *center* of the image in 300x300 space.
        const centerShiftX = (imgX - 150) * (canvasSize / 300);
        const centerShiftY = (imgY - 150) * (canvasSize / 300);
        
        const dX = -dWidth / 2 + centerShiftX;
        const dY = -dHeight / 2 + centerShiftY;

        context.drawImage(image, dX, dY, dWidth, dHeight);
        // --- ASPECT RATIO FIX END ---

        context.restore();
      }
      // Draw selected flag if available
      if (currentFrame === "flag" && selectedFlag && selectedFlag.complete) {
        const targetHeight = 32 * (canvasSize / 300);
        // Correctly calculate targetWidth to maintain the flag's aspect ratio
        const targetWidth = targetHeight * (selectedFlag.width / selectedFlag.height); 
        const x = (canvasSize - targetWidth) / 2;
        const y = canvasSize - targetHeight - 30 * (canvasSize / 300);
        const radius = 6 * (canvasSize / 300);
        const ctx = context;
        ctx.save();
        ctx.shadowColor = "rgba(0, 0, 0, 0.3)";
        ctx.shadowBlur = 8 * (canvasSize / 300);
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 4 * (canvasSize / 300);
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + targetWidth - radius, y);
        ctx.quadraticCurveTo(x + targetWidth, y, x + targetWidth, y + radius);
        ctx.lineTo(x + targetWidth, y + targetHeight - radius);
        ctx.quadraticCurveTo(x + targetWidth, y + targetHeight, x + targetWidth - radius, y + targetHeight);
        ctx.lineTo(x + radius, y + targetHeight);
        ctx.quadraticCurveTo(x, y + targetHeight, x, y + targetHeight - radius);
        ctx.lineTo(x, y + radius);
        ctx.quadraticCurveTo(x, y, x + radius, y);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(selectedFlag, x, y, targetWidth, targetHeight);
        ctx.restore();
      }
      if (currentFrame === "freepalestine") {
        if (frame && frame.complete) {
          context.drawImage(frame, 0, 0, canvasSize, canvasSize);
        }
      }
    }

    function drawMainCanvas() {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      canvas.style.opacity = 0.5;
      drawCanvas(ctx, userImg);
      setTimeout(() => (canvas.style.opacity = 1), 100);
    }

    function resetImage() {
      scale = 1;
      rotation = 0;
      imgX = 150;
      imgY = 150;
      drawMainCanvas();
    }

    function downloadImage() {
      const size = selectedResolution;
      const highResCanvas = document.createElement("canvas");
      highResCanvas.width = size;
      highResCanvas.height = size;
      const highResCtx = highResCanvas.getContext("2d");
      drawCanvas(highResCtx, userImg, size);
      const link = document.createElement("a");
      link.download = `falastech-ppm_${size}x${size}.png`;
      link.href = highResCanvas.toDataURL("image/png");
      link.click();
    }

    async function fetchAvatar(platform) {
      const username = prompt("Enter your " + platform + " username:");
      if (!username) return;
      try {
        const url = `https://unavatar.io/${platform}/${username}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Avatar not found");
        loadImage(url);
      } catch (err) {
        alert("Failed to fetch avatar from " + platform + ". Try again later.");
      }
    }

    function loadImage(src) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
        userImg = img;
        resetImage();
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
        document.getElementById('editControls').classList.remove('hidden');
        document.getElementById('previewButton').classList.add('hidden');
        document.getElementById('step3').classList.add('hidden');
      };
      img.onerror = () => {
        alert("Unable to load the image.");
      };
      img.src = src;
    }

    function zoom(factor) {
      scale *= factor;
      drawMainCanvas();
    }

    function rotateImage() {
      rotation += Math.PI / 8;
      drawMainCanvas();
    }

    function loadFlag(country) {
      if (!country) {
        selectedFlag = null;
        drawMainCanvas();
        return;
      }
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
        selectedFlag = img;
        drawMainCanvas();
      };
      img.onerror = () => {
        alert("Flag failed to load.");
        selectedFlag = null;
      };
      img.src = `https://flagcdn.com/w160/${country_code_map[country]}.png`;
    }

    function changeFrame(type) {
      ['default', 'flag', 'freepalestine'].forEach(frameType => {
        document.getElementById(`frameBtn_${frameType}`).classList.remove('selected');
      });
      document.getElementById(`frameBtn_${type}`).classList.add('selected');
      const countryContainer = document.getElementById("countrySelectorContainer");
      if (type === 'flag') {
        countryContainer.classList.remove('hidden');
      } else {
        countryContainer.classList.add('hidden');
        selectedFlag = null;
      }
      setFrame(type);
      document.getElementById('step3').classList.remove('hidden');
    }

    function selectResolution(res) {
      selectedResolution = res;
      document.querySelectorAll('.resolution-button').forEach(btn => btn.classList.remove('selected'));
      document.getElementById(`resBtn_${res}`).classList.add('selected');
    }

    // Event Listeners
    document.getElementById("upload").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        loadImage(URL.createObjectURL(file));
      }
    });

    document.getElementById("countrySelect").addEventListener("change", (e) => {
      loadFlag(e.target.value);
    });

    const canvas = document.getElementById("canvas");

    function handleDragStart(x, y) {
      startX = x;
      startY = y;
      isDragging = true;
    }

    function handleDragMove(x, y) {
      if (!isDragging || !userImg) return;
      const dx = x - startX;
      const dy = y - startY;
      imgX = imgX + dx;
      imgY = imgY + dy;
      startX = x;
      startY = y;
      drawMainCanvas();
    }
    canvas.addEventListener("mousedown", (e) => {
      handleDragStart(e.offsetX, e.offsetY);
    });
    canvas.addEventListener("mousemove", (e) => {
      handleDragMove(e.offsetX, e.offsetY);
    });
    canvas.addEventListener("mouseup", () => isDragging = false);
    canvas.addEventListener("mouseleave", () => isDragging = false);
    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      handleDragStart(touch.clientX - rect.left, touch.clientY - rect.top);
    });
    canvas.addEventListener("touchmove", (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      handleDragMove(touch.clientX - rect.left, touch.clientY - rect.top);
    });
    canvas.addEventListener("touchend", () => isDragging = false);

    // Buttons
    document.getElementById("themeButton").addEventListener("click", toggleDarkMode);
    document.getElementById("zoomInBtn").addEventListener("click", () => zoom(1.1));
    document.getElementById("zoomOutBtn").addEventListener("click", () => zoom(0.9));
    document.getElementById("rotateBtn").addEventListener("click", rotateImage);
    document.getElementById("resetBtn").addEventListener("click", resetImage);
    document.getElementById("downloadBtn").addEventListener("click", downloadImage);

    // Initial Setup
    setFrame('default');
    lucide.createIcons();

    // Load an example image
    userImg = new Image();
    userImg.crossOrigin = "anonymous";
    userImg.onload = () => {
      drawMainCanvas();
    };
    userImg.onerror = () => {
      console.warn("Example image not found. Will draw only the frame.");
      userImg = null;
      drawMainCanvas();
    };
    userImg.src = "assets/user.jpg";

    // Browser Warning
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    const inAppBrowser = /FBAN|FBAV|Instagram|Line|Twitter/i.test(ua);
    if (inAppBrowser) {
      document.getElementById("browserWarning").classList.remove("hidden");
    }
  </script>
</body>

</html>